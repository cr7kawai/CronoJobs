<app-menu></app-menu>
<div *ngIf="proyectosArea.length > 0">
    <div class="card">
        <div class="card-title" *ngIf="rol == 3">
            <div class="row">
                <div class="col-8">
                    <mat-form-field class="search-input">
                    <input class="filtro" matInput (input)="proyectosAreaFiltro($event)" placeholder="Buscar proyectos">
                    </mat-form-field>
                </div>
                <div class="col-2"></div>
                <div class="col-2">
                    <button mat-icon-button class="btn btn-secondary agregar" (click)="abrirRegistroModal()">
                    Agregar proyecto
                    </button>
                </div>
            </div>
        </div>
        <div class="card-title" *ngIf="rol != 3">
          <div class="row">
              <div class="col-12">
                  <mat-form-field class="search-input">
                  <input class="filtro" matInput (input)="proyectosAreaFiltro($event)" placeholder="Buscar proyectos">
                  </mat-form-field>
              </div>
          </div>
      </div>
        <div class="card-body">
            <mat-table [dataSource]="proyectosAreaDataSource">

                <ng-container matColumnDef="Nombre" class="mat-column-Nombre">
                <th mat-header-cell *matHeaderCellDef><strong>Nombre</strong></th>
                <td mat-cell *matCellDef="let row">{{ row.nombre }}</td>
                </ng-container>

                <ng-container matColumnDef="Fecha de inicio" class="mat-column-Fecha">
                <th mat-header-cell *matHeaderCellDef><strong>Fecha de inicio</strong></th>
                <td mat-cell *matCellDef="let row">{{ row.fecha_inicio.substring(0, 10) }}</td>
                </ng-container>

                <ng-container matColumnDef="Fecha de finalizacion" class="mat-column-Fecha">
                <th mat-header-cell *matHeaderCellDef><strong>Fecha de finalizacion</strong></th>
                <td mat-cell *matCellDef="let row">{{ row.fecha_fin.substring(0, 10) }}</td>
                </ng-container>

                <ng-container matColumnDef="Estado" class="mat-column-Rol">
                <th mat-header-cell *matHeaderCellDef><strong>Estado</strong></th>
                <td mat-cell *matCellDef="let row">{{ row.estado }}</td>
                </ng-container>

                <ng-container matColumnDef="Fecha de término" class="mat-column-Fecha">
                    <th mat-header-cell *matHeaderCellDef><strong>Fecha de término</strong></th>
                    <td mat-cell *matCellDef="let row">{{ row.fecha_termino !== null && row.fecha_termino !== '' ? row.fecha_termino.substring(0, 10) : '----------' }}</td>
                </ng-container>

                <ng-container matColumnDef="Acciones" class="mat-column-Acciones">
                    <th mat-header-cell *matHeaderCellDef><strong>Acciones</strong></th>
                    <td mat-cell *matCellDef="let row">
                        <a mat-icon-button class="btn btn-primary" href="vista-proyecto/{{row.pk_proyecto}}" matTooltip="Ver"><mat-icon>visibility</mat-icon></a>
                        <button mat-icon-button *ngIf="rol == 3" class="btn btn-success" matTooltip="Modificar" (click)="abrirModificacionModal(row.pk_proyecto)"><mat-icon>edit</mat-icon></button>
                        <a mat-icon-button *ngIf="rol != 4" class="btn btn-info"  matTooltip="Estadística" href="/estadistica-proyecto/{{row.pk_proyecto}}"><mat-icon>pie_chart</mat-icon></a>
                        <button mat-icon-button *ngIf="rol == 3" class="btn btn-danger" matTooltip="Eliminar" (click)="eliminarProyecto(row.pk_proyecto)"><mat-icon>delete</mat-icon></button>
                        </td>
                </ng-container>
            
                <mat-header-row *matHeaderRowDef="displayedColumnsArea"></mat-header-row>
                <mat-row *matRowDef="let row; columns: displayedColumnsArea"></mat-row>
            </mat-table>
        </div>
    </div>
</div>

<div *ngIf="proyectos.length > 0">
    <div class="card">
        <div class="card-title">
            <div class="row">
                <div class="col-12">
                    <mat-form-field class="search-input">
                    <input class="filtro" matInput (input)="proyectosFiltro($event)" placeholder="Buscar proyectos">
                    </mat-form-field>
                </div>
            </div>
        </div>
        <div class="card-body">
            <mat-table [dataSource]="proyectosDataSource">

                <ng-container matColumnDef="Nombre" class="mat-column-Nombre">
                <th mat-header-cell *matHeaderCellDef><strong>Nombre</strong></th>
                <td mat-cell *matCellDef="let row">{{ row.nombre }}</td>
                </ng-container>

                <ng-container matColumnDef="Fecha de inicio" class="mat-column-Fecha">
                <th mat-header-cell *matHeaderCellDef><strong>Fecha de inicio</strong></th>
                <td mat-cell *matCellDef="let row">{{ row.fecha_inicio.substring(0, 10) }}</td>
                </ng-container>

                <ng-container matColumnDef="Fecha de finalizacion" class="mat-column-Fecha">
                <th mat-header-cell *matHeaderCellDef><strong>Fecha de finalizacion</strong></th>
                <td mat-cell *matCellDef="let row">{{ row.fecha_fin.substring(0, 10) }}</td>
                </ng-container>

                <ng-container matColumnDef="Estado" class="mat-column-Rol">
                <th mat-header-cell *matHeaderCellDef><strong>Estado</strong></th>
                <td mat-cell *matCellDef="let row">{{ row.estado }}</td>
                </ng-container>

                <ng-container matColumnDef="Fecha de término" class="mat-column-Fecha">
                    <th mat-header-cell *matHeaderCellDef><strong>Fecha de término</strong></th>
                    <td mat-cell *matCellDef="let row">{{ row.fecha_termino !== null && row.fecha_termino !== '' ? row.fecha_termino.substring(0, 10) : '----------' }}</td>
                </ng-container>

                <ng-container matColumnDef="Area" class="mat-column-Area">
                <th mat-header-cell *matHeaderCellDef><strong>Área</strong></th>
                <td mat-cell *matCellDef="let row">{{ row.area }}</td>
                </ng-container>

                <ng-container matColumnDef="Acciones" class="mat-column-Acciones">
                    <th mat-header-cell *matHeaderCellDef><strong>Acciones</strong></th>
                    <td mat-cell *matCellDef="let row">
                      <a mat-icon-button class="btn btn-primary" href="vista-proyecto/{{row.pk_proyecto}}" matTooltip="Ver"><mat-icon>visibility</mat-icon></a>
                        <a mat-icon-button class="btn btn-success" matTooltip="Actividades" href="/actividades/{{row.pk_proyecto}}"><mat-icon>list_alt</mat-icon></a>
                        <a mat-icon-button class="btn btn-info" matTooltip="Estadística" href="/estadistica-proyecto/{{row.pk_proyecto}}"><mat-icon>pie_chart</mat-icon></a>
                      </td>
                </ng-container>
            
                <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                <mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
            </mat-table>
        </div>
    </div>
</div>

<div class="overlay" *ngIf="registroModalAbierto">
  <mat-dialog-content class="modal-dialog-right registro">
    <form class="centered-form">
      <div class="form-title">
        <h2 style="color: #020061;">Agregar proyecto</h2>
      </div>
      <div class="row">
        <div class="col-md-12">
          <label>Nombre del proyecto: </label>
          <input type="text" class="form-control texto" id="nombre" placeholder="BMW Custom" [(ngModel)]="proyectoCreado.nombre" [ngModelOptions]="{standalone: true}">
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <label>Descripción: </label>
          <textarea class="form-control texto" name="descripcion" id="descripcion" cols="30" rows="6" placeholder="Generar modificaciones en el vehículo..." [(ngModel)]="proyectoCreado.descripcion" [ngModelOptions]="{standalone: true}"></textarea>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <label>Fecha de inicio: </label>
          <input type="date" class="form-control texto" id="fecha_inicio" [(ngModel)]="proyectoCreado.fecha_inicio" [ngModelOptions]="{standalone: true}">
        </div>
        <div class="col-md-6">
            <label>Fecha de finalización: </label>
            <input type="date" class="form-control texto" id="fecha_fin" [(ngModel)]="proyectoCreado.fecha_fin" [ngModelOptions]="{standalone: true}">
        </div>
      </div>
      <div class="row centered-buttons">
        <div class="col-md-12 text-center">
          <button mat-raised-button type="submit" class="btn btn-danger btn-large" (click)="cerrarRegistroModal()">Cerrar</button>
          <button type="submit" class="btn btn-primary btn-large guardar" (click)="crearProyecto()">Guardar</button>
        </div>
      </div>
    </form>
  </mat-dialog-content>
</div>

<div class="overlay" *ngIf="modificacionModalAbierto">
  <mat-dialog-content class="modal-dialog-right registro">
    <form class="centered-form">
      <div class="form-title">
        <h2 style="color: #020061;">Modificar proyecto</h2>
      </div>
      <div class="row">
        <div class="col-md-12">
          <label>Nombre del proyecto: </label>
          <input type="text" class="form-control texto" id="nombre" placeholder="BMW Custom" [(ngModel)]="modificacionProyecto.nombre" [ngModelOptions]="{standalone: true}">
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <label>Descripción: </label>
          <textarea class="form-control texto" name="descripcion" id="descripcion" cols="30" rows="6" placeholder="Generar modificaciones en el vehículo..." [(ngModel)]="modificacionProyecto.descripcion" [ngModelOptions]="{standalone: true}"></textarea>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <label>Fecha de inicio: </label>
          <input type="date" class="form-control texto" id="fecha_inicio" [(ngModel)]="modificacionProyecto.fecha_inicio" [ngModelOptions]="{standalone: true}">
        </div>
        <div class="col-md-6">
            <label>Fecha de finalización: </label>
            <input type="date" class="form-control texto" id="fecha_fin" [(ngModel)]="modificacionProyecto.fecha_fin" [ngModelOptions]="{standalone: true}">
        </div>
      <div class="row centered-buttons">
        <div class="col-md-12 text-center">
          <button mat-raised-button type="submit" class="btn btn-danger btn-large" (click)="cerrarModificacionModal()">Cerrar</button>
          <button type="submit" class="btn btn-primary btn-large guardar" (click)="modificarProyecto()">Guardar</button>
        </div>
      </div>
      </div>
    </form>
  </mat-dialog-content>
</div>