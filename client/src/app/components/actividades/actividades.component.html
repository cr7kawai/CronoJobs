<app-menu></app-menu>

<div>
    <div class="card">
        <div class="card-title" *ngIf="rol == 3">
            <div class="row">
                <div class="col-md-8">
                    <mat-form-field class="search-input">
                    <input class="filtro" matInput (input)="actividadesFiltro($event)" placeholder="Buscar actividades">
                    </mat-form-field>
                </div>
                <div class="col-2"></div>
                <div class="col-2">
                    <button mat-icon-button class="btn btn-secondary agregar" (click)="abrirRegistroModal()">
                    Agregar actividad
                    </button>
                </div>
            </div>
        </div>
        <div class="card-title" *ngIf="rol != 3">
          <div class="row">
              <div class="col-md-12">
                  <mat-form-field class="search-input">
                  <input class="filtro" matInput (input)="actividadesFiltro($event)" placeholder="Buscar actividades">
                  </mat-form-field>
              </div>
          </div>
      </div>
        <div class="card-body">
            <mat-table [dataSource]="dataSource">

                <ng-container matColumnDef="Nombre" class="mat-column-Nombre">
                <th mat-header-cell *matHeaderCellDef><strong>Nombre</strong></th>
                <td mat-cell *matCellDef="let row">{{ row.nombre }}</td>
                </ng-container>

                <ng-container matColumnDef="Fecha de inicio" class="mat-column-Fecha">
                <th mat-header-cell *matHeaderCellDef><strong>Fecha de inicio</strong></th>
                <td mat-cell *matCellDef="let row">{{ row.fecha_inicio.substring(0, 10) }}</td>
                </ng-container>

                <ng-container matColumnDef="Fecha de finalizacion" class="mat-column-Fecha">
                <th mat-header-cell *matHeaderCellDef><strong>Fecha de finalizacion</strong></th>
                <td mat-cell *matCellDef="let row">{{ row.fecha_fin.substring(0, 10) }}</td>
                </ng-container>

                <ng-container matColumnDef="Estado" class="mat-column-Rol">
                <th mat-header-cell *matHeaderCellDef><strong>Estado</strong></th>
                <td mat-cell *matCellDef="let row">{{ row.estado }}</td>
                </ng-container>

                <ng-container matColumnDef="Fecha de término" class="mat-column-Fecha">
                    <th mat-header-cell *matHeaderCellDef><strong>Fecha de término</strong></th>
                    <td mat-cell *matCellDef="let row">{{ row.fecha_termino !== null && row.fecha_termino !== '' ? row.fecha_termino.substring(0, 10) : '----------' }}</td>
                </ng-container>

                <ng-container matColumnDef="Acciones" class="mat-column-Acciones">
                    <th mat-header-cell *matHeaderCellDef><strong>Acciones</strong></th>
                    <td mat-cell *matCellDef="let row">
                        <a mat-icon-button class="btn btn-primary" matTooltip="Ver" href="/vista-actividad/{{row.fk_proyecto}}/{{row.pk_actividad}}"><mat-icon>visibility</mat-icon></a>
                        <button mat-icon-button *ngIf="rol == 3" class="btn btn-success" matTooltip="Modificar" (click)="abrirModificacionModal(row.pk_actividad)"><mat-icon>edit</mat-icon></button>
                        <button mat-icon-button *ngIf="rol == 3" class="btn btn-danger" matTooltip="Eliminar" (click)="eliminarActividad(row.pk_actividad)"><mat-icon>delete</mat-icon></button>
                        </td>
                </ng-container>
            
                <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                <mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
            </mat-table>
        </div>
    </div>
</div>

<div class="overlay" *ngIf="registroModalAbierto">
  <mat-dialog-content class="modal-dialog-right registro">
    <form class="centered-form">
      <div class="form-title">
        <h2 style="color: #020061;">Agregar actividad</h2>
      </div>
      <div class="row">
        <div class="col-md-12">
          <label>Nombre de la actividad: </label>
          <input type="text" class="form-control texto" id="nombre" placeholder="BMW Custom" [(ngModel)]="actividadCreada.nombre" [ngModelOptions]="{standalone: true}">
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <label>Descripción: </label>
          <textarea class="form-control texto" name="descripcion" id="descripcion" cols="30" rows="6" placeholder="Generar modificaciones en el vehículo..." [(ngModel)]="actividadCreada.descripcion" [ngModelOptions]="{standalone: true}"></textarea>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <label>Fecha de inicio: </label>
          <input type="date" class="form-control texto" id="fecha_inicio" [(ngModel)]="actividadCreada.fecha_inicio" [ngModelOptions]="{standalone: true}">
        </div>
        <div class="col-md-6">
            <label>Fecha de finalización: </label>
            <input type="date" class="form-control texto" id="fecha_fin" [(ngModel)]="actividadCreada.fecha_fin" [ngModelOptions]="{standalone: true}">
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <label>Empleado que realizará la actividad: </label> 
          <select class="form-control" name="usuario" id="usuario" [(ngModel)]="actividadCreada.fk_usuario" [ngModelOptions]="{standalone: true}">
            <option *ngFor="let usuario of usuarios" value="{{usuario.pk_usuario}}">{{usuario.pk_usuario}}  -  {{usuario.nombre}} {{usuario.ape_paterno}} {{usuario.ape_materno}}</option>
          </select>
        </div>
      </div>
      <div class="row centered-buttons">
        <div class="col-md-12 text-center">
          <button mat-raised-button type="submit" class="btn btn-danger btn-large" (click)="cerrarRegistroModal()">Cerrar</button>
          <button type="submit" class="btn btn-primary btn-large guardar" (click)="crearActividad()">Guardar</button>
        </div>
      </div>
    </form>
  </mat-dialog-content>
</div>

<div class="overlay" *ngIf="modificacionModalAbierto">
  <mat-dialog-content class="modal-dialog-right registro">
    <form class="centered-form">
      <div class="form-title">
        <h2 style="color: #020061;">Modificar actividad</h2>
      </div>
      <div class="row">
        <div class="col-md-12">
          <label>Nombre de la actividad: </label>
          <input type="text" class="form-control texto" id="nombre" placeholder="BMW Custom" [(ngModel)]="modificacionActividad.nombre" [ngModelOptions]="{standalone: true}">
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <label>Descripción: </label>
          <textarea class="form-control texto" name="descripcion" id="descripcion" cols="30" rows="6" placeholder="Generar modificaciones en el vehículo..." [(ngModel)]="modificacionActividad.descripcion" [ngModelOptions]="{standalone: true}"></textarea>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <label>Fecha de inicio: </label>
          <input type="date" class="form-control texto" id="fecha_inicio" [(ngModel)]="modificacionActividad.fecha_inicio" [ngModelOptions]="{standalone: true}">
        </div>
        <div class="col-md-6">
            <label>Fecha de finalización: </label>
            <input type="date" class="form-control texto" id="fecha_fin" [(ngModel)]="modificacionActividad.fecha_fin" [ngModelOptions]="{standalone: true}">
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <label>Empleado que realizará la actividad: </label> 
          <select class="form-control" name="usuario" id="usuario" [(ngModel)]="modificacionActividad.fk_usuario" [ngModelOptions]="{standalone: true}">
            <option *ngFor="let usuario of usuarios" value="{{usuario.pk_usuario}}">{{usuario.pk_usuario}}  -  {{usuario.nombre}} {{usuario.ape_paterno}} {{usuario.ape_materno}}</option>
          </select>
        </div>
      </div>
      <div class="row centered-buttons">
        <div class="col-md-12 text-center">
          <button mat-raised-button type="submit" class="btn btn-danger btn-large" (click)="cerrarModificacionModal()">Cerrar</button>
          <button type="submit" class="btn btn-primary btn-large guardar" (click)="modificarActividad()">Guardar</button>
        </div>
      </div>
    </form>
  </mat-dialog-content>
</div>